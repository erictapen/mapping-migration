<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <svg xmlns="http://www.w3.org/2000/svg" id="unhcr" viewBox="0 0 100 100" width="1200px" height="800px">
            <ellipse id="coo" cx="20" cy="50" rx="20" ry="8" fill="none" stroke="black" stroke-width="0.1"/>
            <ellipse id="coa" cx="80" cy="40" rx="20" ry="8" fill="none" stroke="black" stroke-width="0.1"/>
            <g id="stickfigure" transform="scale(0.5, 0.5)">
                <path
                    fill="white"
                    stroke="black"
                    stroke-width="0.2"
                    d="M 0 0 l -2 2 m 2 -2 l 2 2 m -2 -2 l 0 -3 m 0 0 l 2 0 m -2 0 l -2 0 m 2 0 a 1 1 0 0 0 0 -2 a 1 1 0 0 0 0 2"
                />
            </g>
        </svg>
        <script type="text/javascript">
            // angle for calculating the perspective
            const orthographicFactor = 0.4;
            let svg = document.getElementById("unhcr");

            [...Array(500).keys()].map(i => {
                let newElement = document.createElementNS("http://www.w3.org/2000/svg", "use");
                newElement.setAttribute("href", "#stickfigure");
                // Stick Figure
                newElement.setAttribute("id", "sf"+i);
                let phi = Math.random() * 2 * Math.PI;
                let r = Math.random() * (20 - 4);
                newElement.setAttribute("x", 20 + Math.sin(phi) * r);
                newElement.setAttribute("y", 50 + Math.cos(phi) * r * orthographicFactor);
                svg.appendChild(newElement);
            });

            function move() {
                let coa = svg.getElementById("coa");
                let coaX = coa.getAttribute("cx");
                let coaY = coa.getAttribute("cy");
                console.log(coaX + " " + coaY);
                Array.from(svg.children).map(node => {
                    if (node.getAttributeNS(null, "id").startsWith("sf")) {
                        let x = Number(node.getAttribute("x"));
                        let y = Number(node.getAttribute("y"));
                        let dx = coaX - x;
                        let dy = coaY - y;
                        let length = Math.sqrt(dx * dx + dy * dy);
                        node.setAttribute("x", x + 0.25 * (dx / length));
                        node.setAttribute("y", y + 0.25 * (dy / length));
                    }
                });
            }

            setInterval(move, 20);

            console.log("feddich");

        </script>
    </body>
</html>

